<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8">
  <title>Admin Panel - Live</title>
  <style>
    body { font-family: sans-serif; background: #f0f2f5; padding: 20px; }
    #feed { max-width: 800px; margin: auto; }
    .msg { background: white; padding: 15px; border-radius: 8px; margin-bottom: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
    .meta { font-size: 0.85em; color: #666; margin-bottom: 8px; }
    img { max-width: 100%; border-radius: 8px; display: block; margin-top: 10px; }
  </style>
</head>
<body>
  <h2 style="text-align:center;">Pannello Admin - Webcam + Messaggi Live</h2>
  <div id="feed"></div>

  <script>
    const ws = new WebSocket((location.protocol === "https:" ? "wss://" : "ws://") + location.host);

    ws.onmessage = (event) => {
      const data = JSON.parse(event.data);
      const feed = document.getElementById("feed");
      
      const div = document.createElement("div");
      div.className = "msg";
      
      const meta = document.createElement("div");
      meta.className = "meta";
      meta.textContent = `${data.user} â€¢ ${new Date(data.ts).toLocaleTimeString()}`;
      
      div.appendChild(meta);

      if (data.type === 'webcam_frame') {
        const img = document.createElement("img");
        img.src = data.image;
        div.appendChild(img);
      } else {
        const content = document.createElement("div");
        content.style.fontWeight = "bold";
        content.textContent = data.message || "";
        div.appendChild(content);
      }
      
      feed.prepend(div);
    };
  </script>
</body>
</html>