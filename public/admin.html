<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8">
  <title>Admin â€“ Verifiche</title>
  <style>
    body { font-family:Arial; background:#f0f0f0; padding:20px; margin:0; }
    h1 { text-align:center; }
    #feed { max-width:900px; margin:0 auto; }
    .user-box { background:white; border-radius:8px; padding:15px; margin:20px 0; box-shadow:0 2px 10px rgba(0,0,0,0.1); }
    img { width:100%; max-width:600px; border-radius:6px; }
    button { padding:10px 20px; font-size:16px; margin:10px 5px; cursor:pointer; }
    #saveBtn { background:#28a745; color:white; border:none; }
    #stopBtn { background:#dc3545; color:white; border:none; }
  </style>
</head>
<body>
<h1>Verifiche in arrivo</h1>
<div id="feed"></div>

<script>
  const ws = new WebSocket((location.protocol === 'https:' ? 'wss:' : 'ws:') + location.host);
  let currentImg = null;

  ws.onopen = () => console.log('Connesso');

  ws.onmessage = (event) => {
    if (typeof event.data === 'string') {
      const box = document.createElement('div');
      box.className = 'user-box';

      currentImg = document.createElement('img');
      currentImg.src = event.data; // base64
      box.appendChild(currentImg);

      const saveBtn = document.createElement('button');
      saveBtn.textContent = 'Salva Foto Completa';
      saveBtn.onclick = () => {
        const a = document.createElement('a');
        a.href = currentImg.src;
        a.download = `verifica_${Date.now()}.jpg`;
        a.click();
      };
      box.appendChild(saveBtn);

      const stopBtn = document.createElement('button');
      stopBtn.textContent = 'Ferma e Salva';
      stopBtn.onclick = () => {
        ws.send(JSON.stringify({ type: 'stop' }));
        saveBtn.click();
      };
      box.appendChild(stopBtn);

      document.getElementById('feed').prepend(box); // aggiungi in alto per feed live
    }
  };
</script>
</body>
</html>